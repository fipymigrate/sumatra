#!/usr/bin/env python
"""
Command-line interface to the Sumatra computational experiment management tool.
"""

from __future__ import unicode_literals
from builtins import str
import sys
from sumatra import commands, __version__
from sumatra.versioncontrol.base import VersionControlError
from sumatra.recordstore.base import RecordStoreAccessError

usage = """Usage: smt <subcommand> [options] [args]

Simulation/analysis management tool version %s

Available subcommands:
  """ % __version__
usage += "\n  ".join(commands.modes)

# Workaround for Py2/Py3 compatibility: convert arguments to type 'str',
# otherwise a comparison such as "isinstance(x, str)" may fail further
# down the line. This is due to a bug in python-future; see:
# https://github.com/PythonCharmers/python-future/issues/170
sys.argv = [str(x) for x in sys.argv]

if len(sys.argv) < 2:
    print(usage)
    sys.exit(1)

cmd = sys.argv[1]
try:
    main = getattr(commands, cmd)
except AttributeError:
    print(usage)
    sys.exit(1)

try:
    main(sys.argv[2:])
except (VersionControlError, RecordStoreAccessError) as err:
    print("Error: {}".format(err))
    sys.exit(1)
